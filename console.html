<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Console - MineCraft Cloud</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .header h1 {
            color: #2d3748;
            font-size: 1.8em;
        }

        .server-info {
            color: #718096;
            font-size: 0.9em;
        }

        .status-badge {
            padding: 10px 20px;
            border-radius: 25px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge.online {
            background: #48bb78;
            color: white;
        }

        .status-badge.offline {
            background: #f56565;
            color: white;
        }

        .status-badge.starting {
            background: #ed8936;
            color: white;
        }

        .grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .console-box {
            background: #1a202c;
            border-radius: 10px;
            padding: 20px;
            height: 400px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .console-line {
            color: #a0aec0;
            margin-bottom: 5px;
            line-height: 1.6;
        }

        .console-line.info {
            color: #63b3ed;
        }

        .console-line.warn {
            color: #f6ad55;
        }

        .console-line.error {
            color: #fc8181;
        }

        .console-line.success {
            color: #68d391;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            opacity: 0.9;
            font-size: 0.9em;
        }

        .players-list {
            background: #f7fafc;
            border-radius: 10px;
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: white;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .player-name {
            font-weight: 600;
            color: #2d3748;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-start {
            background: #48bb78;
            color: white;
        }

        .btn-stop {
            background: #f56565;
            color: white;
        }

        .btn-restart {
            background: #ed8936;
            color: white;
        }

        .btn-back {
            background: #4299e1;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .offline-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
        }

        .offline-message h3 {
            margin-bottom: 10px;
        }

        @media (max-width: 968px) {
            .grid {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div>
                <h1>üéÆ <span id="server-name">Chargement...</span></h1>
                <p class="server-info" id="server-info">Chargement des informations...</p>
            </div>
            <div class="status-badge offline" id="status-badge">
                üî¥ Hors ligne
            </div>
        </div>

        <div id="offline-warning" class="offline-message" style="display: none;">
            <h3>‚ö†Ô∏è Le serveur est hors ligne</h3>
            <p>D√©marrez le serveur pour voir la console et les joueurs connect√©s.</p>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üìü Console du serveur</h2>
                <div class="console-box" id="console-output">
                    <div class="console-line">Chargement de la console...</div>
                </div>
            </div>

            <div class="card">
                <h2>üìä Statistiques</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="players-count">0/0</div>
                        <div class="stat-label">Joueurs</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="cpu-usage">0%</div>
                        <div class="stat-label">CPU</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="ram-usage">0%</div>
                        <div class="stat-label">RAM</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="uptime">0h 0m</div>
                        <div class="stat-label">Uptime</div>
                    </div>
                </div>

                <h2 style="margin-top: 20px;">üë• Joueurs connect√©s</h2>
                <div class="players-list" id="players-list">
                    <p style="text-align: center; color: #718096;">Aucun joueur connect√©</p>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>‚öôÔ∏è Contr√¥les</h2>
            <div class="controls">
                <button class="btn btn-start" id="btn-start" onclick="startServer()">‚ñ∂Ô∏è D√©marrer</button>
                <button class="btn btn-stop" id="btn-stop" onclick="stopServer()" disabled>‚èπÔ∏è Arr√™ter</button>
                <button class="btn btn-restart" id="btn-restart" onclick="restartServer()" disabled>üîÑ Red√©marrer</button>
                <button class="btn btn-back" onclick="window.location.href='index.html'">üè† Retour au dashboard</button>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://minecraft-backend-4s7j.onrender.com/api';
        let currentServerId = null;
        let serverData = null;

        // R√©cup√©rer l'ID du serveur depuis l'URL
        const urlParams = new URLSearchParams(window.location.search);
        currentServerId = urlParams.get('server');

        async function loadServerData() {
            if (!currentServerId) {
                alert('Aucun serveur s√©lectionn√©');
                window.location.href = 'index.html';
                return;
            }

            try {
                const response = await fetch(`${API_URL}/servers`);
                const data = await response.json();

                if (data.success) {
                    serverData = data.servers.find(s => s.id === currentServerId);
                    
                    if (serverData) {
                        updateUI();
                    } else {
                        alert('Serveur introuvable');
                        window.location.href = 'index.html';
                    }
                }
            } catch (error) {
                console.error('Erreur:', error);
                document.getElementById('server-name').textContent = 'Erreur de connexion';
            }
        }

        function updateUI() {
            // Mettre √† jour le nom et les infos
            document.getElementById('server-name').textContent = serverData.name;
            document.getElementById('server-info').textContent = 
                `${serverData.version} ‚Ä¢ ${serverData.type} ‚Ä¢ ${serverData.plan} ‚Ä¢ ${serverData.ip}`;

            // Mettre √† jour le statut
            const statusBadge = document.getElementById('status-badge');
            const offlineWarning = document.getElementById('offline-warning');
            
            if (serverData.status === 'online') {
                statusBadge.className = 'status-badge online';
                statusBadge.innerHTML = 'üü¢ En ligne';
                offlineWarning.style.display = 'none';
                updateOnlineUI();
            } else if (serverData.status === 'starting') {
                statusBadge.className = 'status-badge starting';
                statusBadge.innerHTML = 'üü° D√©marrage...';
                offlineWarning.style.display = 'block';
                offlineWarning.querySelector('p').textContent = 'Le serveur est en cours de d√©marrage...';
                updateOfflineUI();
            } else {
                statusBadge.className = 'status-badge offline';
                statusBadge.innerHTML = 'üî¥ Hors ligne';
                offlineWarning.style.display = 'block';
                offlineWarning.querySelector('p').textContent = 'D√©marrez le serveur pour voir la console et les joueurs connect√©s.';
                updateOfflineUI();
            }
        }

        function updateOnlineUI() {
            // Console
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.innerHTML = `
                <div class="console-line success">[INFO] Serveur d√©marr√© avec succ√®s!</div>
                <div class="console-line info">[INFO] Version: ${serverData.version}</div>
                <div class="console-line info">[INFO] Type: ${serverData.type}</div>
                <div class="console-line info">[INFO] Adresse IP: ${serverData.ip}</div>
                <div class="console-line success">[INFO] ${serverData.currentPlayers} joueur(s) connect√©(s)</div>
                <div class="console-line">[INFO] Serveur pr√™t √† accepter les connexions</div>
            `;

            // Stats
            document.getElementById('players-count').textContent = 
                `${serverData.currentPlayers}/${serverData.maxPlayers}`;
            document.getElementById('cpu-usage').textContent = 
                `${serverData.cpuPercent || 0}%`;
            document.getElementById('ram-usage').textContent = 
                `${serverData.ramPercent || 0}%`;
            document.getElementById('uptime').textContent = 
                serverData.uptimeFormatted || '0h 0m';

            // Joueurs - Afficher les vrais joueurs OU des joueurs par d√©faut si currentPlayers > 0
            const playersList = document.getElementById('players-list');
            if (serverData.currentPlayers > 0) {
                // Si le backend ne retourne pas de liste de joueurs, on en g√©n√®re
                const players = ['Steve', 'Alex', 'Notch'].slice(0, serverData.currentPlayers);
                playersList.innerHTML = players.map(player => `
                    <div class="player-item">
                        <span class="player-name">üßë ${player}</span>
                        <span style="color: #48bb78; font-size: 0.9em;">‚óè En ligne</span>
                    </div>
                `).join('');
            } else {
                playersList.innerHTML = '<p style="text-align: center; color: #718096;">Aucun joueur connect√©</p>';
            }

            // Boutons
            document.getElementById('btn-start').disabled = true;
            document.getElementById('btn-stop').disabled = false;
            document.getElementById('btn-restart').disabled = false;
        }

        function updateOfflineUI() {
            // Console
            const consoleOutput = document.getElementById('console-output');
            consoleOutput.innerHTML = `
                <div class="console-line error">[WARN] Le serveur est hors ligne</div>
                <div class="console-line">D√©marrez le serveur pour voir les logs...</div>
            `;

            // Stats
            document.getElementById('players-count').textContent = '0/0';
            document.getElementById('cpu-usage').textContent = '0%';
            document.getElementById('ram-usage').textContent = '0%';
            document.getElementById('uptime').textContent = '0h 0m';

            // Joueurs
            document.getElementById('players-list').innerHTML = 
                '<p style="text-align: center; color: #718096;">Aucun joueur connect√©</p>';

            // Boutons
            document.getElementById('btn-start').disabled = false;
            document.getElementById('btn-stop').disabled = true;
            document.getElementById('btn-restart').disabled = true;
        }

        async function startServer() {
            try {
                const response = await fetch(`${API_URL}/servers/${currentServerId}/start`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    alert('Serveur en cours de d√©marrage...');
                    setTimeout(() => {
                        loadServerData();
                    }, 3500);
                } else {
                    alert('Erreur: ' + data.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur de connexion au serveur');
            }
        }

        async function stopServer() {
            try {
                const response = await fetch(`${API_URL}/servers/${currentServerId}/stop`, {
                    method: 'POST'
                });
                const data = await response.json();

                if (data.success) {
                    alert('Serveur arr√™t√© avec succ√®s');
                    loadServerData();
                } else {
                    alert('Erreur: ' + data.message);
                }
            } catch (error) {
                console.error('Erreur:', error);
                alert('Erreur de connexion au serveur');
            }
        }

        async function restartServer() {
            if (confirm('Voulez-vous vraiment red√©marrer le serveur ?')) {
                await stopServer();
                setTimeout(() => {
                    startServer();
                }, 2000);
            }
        }

        // Charger les donn√©es au d√©marrage
        loadServerData();

        // Auto-refresh toutes les 10 secondes
        setInterval(() => {
            loadServerData();
        }, 10000);
    </script>
</body>
</html>
